var notificator={css:{menu:{background:'transparent url(index.php?pf=commentNotifications/img/bubble.png) no-repeat top 20px',height:'24px',width:'24px',overflow:'hidden',position:'absolute','text-align':'center','font-weight':'bold',display:'none'}},cookie:'dc_nb_comments',msg:{},init:function(){if($.cookie(notificator.cookie)==null||notificator.reload_nb_comments=='true')$.cookie(notificator.cookie,notificator.nb_comments);var p={top:$('li a[href="comments.php"]').position().top-20,left:$('li a[href="comments.php"]').position().left+$('li a[href="comments.php"]').width()-25};notificator.css.menu=$.extend(notificator.css.menu,p);$('li a[href="comments.php"]').parent().append('<li class="new" rel="comments"></li>');$('li[rel="comments"]').css(notificator.css.menu);notificator.getNbComments()},getNbComments:function(){$.get('services.php',{f:'getNbComments'},function(data){var rsp=$(data).children('rsp')[0];if(rsp.attributes[0].value=='ok'){var delta=$(rsp).find('comments').text()-$.cookie(notificator.cookie);if(delta>0)notificator.applyChanges(delta)};setTimeout('notificator.getNbComments()',10000)})},applyChanges:function(num){var nb_total=parseInt(notificator.nb_comments)+parseInt(num);if(parseInt(notificator.nb_comments)-parseInt($.cookie(notificator.cookie))>0)nb_total=parseInt(notificator.nb_comments);var legend=$('span a[href="comments.php"]'),img=$('a[href="comments.php"] img'),html="";html+=nb_total+" ";html+=notificator.nb_comments>1?notificator.msg.comments:notificator.msg.comment;html+=" ("+num+" ";html+=(num>1?notificator.msg.recents:notificator.msg.recent)+")";legend.html(html);img.attr("src","index.php?pf=commentNotifications/img/comments-b.png").animate();$('li[rel="comments"]').html(num);$('li[rel="comments"]').fadeIn("slow");var r=new RegExp('^\\([0-9]+\\)','g');if($('title').text().match(r)!=null){$('title').text($('title').text().replace(r,'('+num+')'))}else $('title').text('('+num+') '+$('title').text())}};$(document).ready(function(){notificator.init()})